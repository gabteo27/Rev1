import{r as s,j as e,$ as f,a3 as h,a0 as g,q as N,a1 as v,T as y,a2 as b}from"./index-LcRROtdV.js";const o={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"#000",color:"white",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",fontFamily:"sans-serif",textAlign:"center",padding:"1rem"},x={fontSize:"5vw",fontWeight:"bold",letterSpacing:"1vw",padding:"2rem",border:"2px solid #fff",borderRadius:"1rem",backgroundColor:"#333",marginTop:"2rem"},w=()=>{let r=localStorage.getItem("deviceHardwareId");return r||(r=`device_${Date.now()}_${Math.random().toString(36).substring(2,10)}`,localStorage.setItem("deviceHardwareId",r)),r};function E(){const[r,t]=s.useState("initializing"),[l,d]=s.useState(null),[u,p]=s.useState(null);return s.useEffect(()=>{if(localStorage.getItem("authToken")){t("paired");return}const c=w();(async()=>{try{const i=await fetch("/api/screens/initiate-pairing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceHardwareId:c})});if(!i.ok){const n=await i.json();throw new Error(n.message||"No se pudo obtener el código del servidor.")}const a=await i.json();d(a.pairingCode),t("pairing")}catch(i){p(i.message),t("error"),console.error("Error al iniciar emparejamiento:",i)}})();const m=setInterval(async()=>{if(!(r!=="pairing"&&document.visibilityState!=="visible"))try{const i=encodeURIComponent(c),a=await fetch(`/api/screens/pairing-status/${i}`);if(!a.ok)return;const n=await a.json();n.status==="paired"&&(console.log("¡Emparejamiento exitoso!",n),localStorage.setItem("authToken",n.authToken),localStorage.setItem("screenName",n.name),n.playlistId?localStorage.setItem("playlistId",n.playlistId.toString()):localStorage.removeItem("playlistId"),clearInterval(m),t("paired"))}catch(i){console.error("Error durante el polling de estado:",i)}},3e3);return()=>clearInterval(m)},[r]),r==="error"?e.jsxDEV("div",{style:o,children:[e.jsxDEV("h1",{style:{color:"#ef4444"},children:"Error de Conexión"},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:115,columnNumber:9},this),e.jsxDEV("p",{style:{fontSize:"1.5vw",marginTop:"1rem"},children:u},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:116,columnNumber:9},this),e.jsxDEV("p",{style:{fontSize:"1vw",marginTop:"2rem",color:"#aaa"},children:"Verifica la consola para más detalles. Reintentando..."},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:117,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:114,columnNumber:7},this):r==="initializing"?e.jsxDEV("div",{style:o,children:e.jsxDEV("h1",{children:"Inicializando Dispositivo..."},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:123,columnNumber:38},this)},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:123,columnNumber:12},this):r==="pairing"?e.jsxDEV("div",{style:o,children:[e.jsxDEV("h1",{style:{fontSize:"3vw"},children:"Introduce este código en tu panel de administración:"},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:129,columnNumber:9},this),l?e.jsxDEV("div",{style:x,children:l},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:130,columnNumber:24},this):e.jsxDEV("p",{children:"Obteniendo código..."},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:130,columnNumber:70},this)]},void 0,!0,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:128,columnNumber:7},this):r==="paired"?e.jsxDEV(f,{},void 0,!1,{fileName:"/home/runner/workspace/client/src/pages/player.tsx",lineNumber:137,columnNumber:12},this):null}h(document.getElementById("root")).render(e.jsxDEV(g,{client:N,children:e.jsxDEV(v,{defaultTheme:"light",storageKey:"xcientv-ui-theme",children:e.jsxDEV(y,{children:[e.jsxDEV(b,{},void 0,!1,{fileName:"/home/runner/workspace/client/src/main-player.tsx",lineNumber:16,columnNumber:9},void 0),e.jsxDEV(E,{},void 0,!1,{fileName:"/home/runner/workspace/client/src/main-player.tsx",lineNumber:17,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/workspace/client/src/main-player.tsx",lineNumber:15,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/workspace/client/src/main-player.tsx",lineNumber:14,columnNumber:5},void 0)},void 0,!1,{fileName:"/home/runner/workspace/client/src/main-player.tsx",lineNumber:13,columnNumber:3},void 0));
